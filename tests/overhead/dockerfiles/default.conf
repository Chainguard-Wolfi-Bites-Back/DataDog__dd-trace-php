server {
    listen 80;

    access_log /dev/stdout;
    error_log /dev/stdout;

    server_name localhost;

    root /var/www/public;
    index index.php;

    location ~ ^/(status|ping)$ {
            allow 0.0.0.0;
            fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;
            fastcgi_index index.php;
            include fastcgi_params;
            fastcgi_pass php-fpm-release:9000;
    }

    location /master {
         try_files $uri $uri/ /index.php?$query_string;
         fastcgi_split_path_info ^(.+\.php)(/.+)$;
         fastcgi_pass php-fpm-master:9000;
         fastcgi_index index.php;
         include fastcgi_params;
         fastcgi_param DD_AGENT_HOST agent;
         fastcgi_param DD_TRACE_ENABLED true;
         fastcgi_param DD_TRACE_DEBUG true;
         fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;
         fastcgi_param PATH_INFO $fastcgi_path_info;
     }

    location /release {
         try_files $uri $uri/ /index.php?$query_string;
         fastcgi_split_path_info ^(.+\.php)(/.+)$;
         fastcgi_pass php-fpm-release:9000;
         fastcgi_index index.php;
         include fastcgi_params;
         fastcgi_param DD_AGENT_HOST agent;
         fastcgi_param DD_TRACE_ENABLED true;
         fastcgi_param DD_TRACE_DEBUG true;
         fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;
         fastcgi_param PATH_INFO $fastcgi_path_info;
     }

    location /head {
         try_files $uri $uri/ /index.php?$query_string;
         fastcgi_split_path_info ^(.+\.php)(/.+)$;
         fastcgi_pass php-fpm-head:9000;
         fastcgi_index index.php;
         include fastcgi_params;
         fastcgi_param DD_AGENT_HOST agent;
         fastcgi_param DD_TRACE_ENABLED true;
         fastcgi_param DD_TRACE_DEBUG true;
         fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;
         fastcgi_param PATH_INFO $fastcgi_path_info;
     }
}
